<!DOCTYPE html>
<html lang="en">
<head>
	<title>Chain</title>
	<meta charset="UTF-8" />
	<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen, projection" />
	<link href='https://fonts.googleapis.com/css?family=Libre+Baskerville:400,700,400italic' rel='stylesheet' type='text/css'>
	<script type="text/javascript" src="../js/verlet-1.0.0.js"></script>
	
	<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>
	
</head>
<body>
	<script type="text/javascript" src="../site/js/common.js"></script>

	<div id='panel'>
		<div id='ui' style='width: 10%; display: inline-block; vertical-align: top; padding-top: 34px'>
			<a id='simnum'>100</a><br>
			
			<a id='moreGrav'>0.03</a><hr>
			<a>Gravity:</a><br>
			<input type='text' id='setGrav' value='0.3'>
			<a>Now: </a><a id='grav' style='color: black'>0.1</a><hr>
		
		
		</div>
		<div id='divCanvas' style='display: inline-block; vertical-align: top'>
			<canvas id="scratch" style="width: 800px; height: 700px;"></canvas>
		</div>
	</div>

	<script type="text/javascript">
		
	var sim
	var chain
	var canvas=document.getElementById("scratch");
	var ctx	=canvas.getContext("2d")
	var simNumber=0
	
	var grav=0.5
	var dGrav = 0.001
	var newGrav=0.55
	var moreGrav = newGrav - grav

	window.onload = function() {
		

		// canvas dimensions
		var width = parseInt(canvas.style.width);
		var height = parseInt(canvas.style.height);

		// retina
		var dpr = window.devicePixelRatio || 1;
		canvas.width = width*dpr;
		canvas.height = height*dpr;
		canvas.getContext("2d").scale(dpr, dpr);

		// simulation
		sim = new VerletJS(width, height, canvas);
		sim.friction = 0.95;
		sim.gravity.y=grav
		
		// entities
		var X1=width*0.3; X2=width*0.7; Y1=height/2
		var nsteps = 40
		Xstep = (X2-X1)/nsteps
		segz = []
		for (i=0; i<=nsteps/2; i++){
								segz.push(new Vec2(X1+ i * Xstep, Y1 - i * 15))
								
			                }
		xa = segz[segz.length-1].x; ya=segz[segz.length-1].y
		
		
		console.log (xa, ya)
		
		for (i=1; i<=nsteps/2; i++){
								segz.push(new Vec2(xa + i * Xstep, ya + i * 15))
							}
		console.log(segz)
		
		
		chain = sim.lineSegments(segz, 5)
		var pin_chain_0 = chain.pin(0)
		var pin_chain_1 = chain.pin(segz.length-1)
	
		var linWid = 2.5
		
		chain.drawConstraints=function(ctx, compo)
		{
			ctx.save();
			ctx.strokeStyle = "#543324";
			ctx.lineCap = "round";
			
			for(i=0; i<compo.constraints.length; i++)
				{   var con=compo.constraints[i]
					if (!(con instanceof DistanceConstraint ))
					continue;
					
					ctx.beginPath();
					ctx.moveTo(con.a.pos.x, con.a.pos.y);
					ctx.lineTo(con.b.pos.x, con.b.pos.y);
					ctx.lineWidth = linWid;
					ctx.stroke();
				}	
		
			
			ctx.restore();	
		}
		
		chain.drawParticles=function(ctx,compo)
		{	ctx.save();
			ctx.strokeStyle = "Black";
			ctx.fillStyle = "#eb5e34"
			ctx.lineWidth=1
			
			for(i=1; i<compo.particles.length-1; i++)
				{	var cx = compo.particles[i].pos.x
					var cy = compo.particles[i].pos.y
					ctx.beginPath()
					ctx.arc(cx, cy,3.6,0,2*Math.PI)
					ctx.fill()
					ctx.stroke()
				}
				

			cx=chain.particles[0].pos.x; cy = chain.particles[0].pos.y
			ctx.moveTo(cx,cy)
			ctx.beginPath()
			ctx.fillStyle="Yellow"
			ctx.strokeStyle = "Blue"
			ctx.lineWidth = 5			
			ctx.arc(cx,cy,6,0,2*Math.PI)
			ctx.stroke()
			ctx.fill()
			
			
			cx=chain.particles[chain.particles.length-1].pos.x; cy = chain.particles[chain.particles.length-1].pos.y
			ctx.moveTo(cx,cy)
			ctx.beginPath()
			ctx.strokeStyle = "Blue"
			ctx.lineWidth = 5			
			ctx.arc(cx,cy,6,0,2*Math.PI)
			ctx.fillStyle="Yellow"
			
			ctx.stroke()	
			ctx.fill()		
			
			ctx.restore()
			
			
		}
		


		// animation loop
		var loop = function() {
			document.getElementById('simnum').textContent=''+simNumber
			document.getElementById('grav').textContent=grav.toFixed(4)
			
			newGrav=$('#setGrav').val()
			
			moreGrav=newGrav-grav
			if( Math.abs(moreGrav)>0.001 )
			   {
				grav = grav + Math.sign(moreGrav) * dGrav
				sim.gravity.y = grav
				}
			$("#moreGrav").text(''+moreGrav.toFixed(6))
			
			
			
			
			simNumber++
			sim.frame(16);
			sim.draw();
			requestAnimFrame(loop);
		};

		loop();
	};
	
	
	</script>
	<div style="width:30%; border:solid gray 2pt; margin: auto; border-radius: 8px">
	<h2 style='color:black; text-align:center'>Refresh browser to run again</h2>
	<h3 style='color:#574cab; text-align:center;'>Interactive Demo: Please view on desktop/laptop</h3>
	<h4 style='color:black;'><ul><li>Drag any point to shake the chain</li>
	<li>Drag end points to see new shape</li><ul></h4>
	</div>
	
</body>
